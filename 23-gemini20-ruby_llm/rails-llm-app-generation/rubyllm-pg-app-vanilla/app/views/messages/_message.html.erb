<%# Renders a single message bubble %>
<%# Expects a local variable `message` %>

<%# Determine styling based on role %>
<% is_user = message.role.downcase == 'user' %>
<% is_assistant = message.role.downcase == 'assistant' || message.role.downcase == 'model' %>
<%# Add other roles if needed %>

<%# Base classes for all messages %>
<% base_classes = "p-3 rounded-lg shadow-sm max-w-xl lg:max-w-2xl break-words" %>

<%# Role-specific classes %>
<% role_classes = case message.role.downcase
                  when 'user'
                    "bg-blue-100 border border-blue-200 ml-auto" # User messages on the right
                  when 'assistant', 'model'
                    "bg-gray-100 border border-gray-200 mr-auto" # Assistant messages on the left
                  when 'system'
                    "bg-yellow-50 border border-yellow-200 text-gray-600 italic text-sm text-center mx-auto w-full max-w-full" # System messages centered, different style
                  else
                    "bg-white border border-gray-300 mr-auto" # Default/unknown role
                  end
%>

<%# Container for the message, includes Turbo ID %>
<div id="<%= dom_id(message) %>" class="flex"> <%# Use flex to help with alignment %>
  <div class="<%= base_classes %> <%= role_classes %>">

    <%# Optional: Display role explicitly (except maybe for user?) %>
    <% unless is_user || message.role.downcase == 'system' %> <%# Don't show role for user or system %>
      <p class="text-xs font-semibold mb-1 <%= is_assistant ? 'text-gray-600' : 'text-purple-600' %>">
        <%= message.role.capitalize %>
      </p>
    <% end %>

    <%# Display the message content, preserving line breaks %>
    <div class="text-sm text-gray-800 whitespace-pre-wrap">
      <%= message.content %>
    </div>

    <%# Optional: Timestamp %>
    <p class="text-xs text-gray-400 mt-2 text-right">
      <%= time_ago_in_words(message.created_at) %> ago
    </p>
  </div>
</div>
